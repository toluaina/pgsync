spec:
  name: pgsync-demo
  services:
    - name: pgsync
      environment_slug: python
      github:
        repo: toluaina/pgsync
        branch: main
        deploy_on_push: false
      instance_size_slug: apps-s-1vcpu-1gb
      internal_ports:
        - 8080
      build_command: pip install --no-cache-dir pgsync
      run_command: >-
        bash -lc '
        pgsync -c ${SCHEMA:-examples/book/schema.json} -b -d &
        python -m http.server 8080
        '
      envs:
        - key: SCHEMA
          value: examples/book/schema.json
          scope: RUN_TIME
        - key: PG_URL
          value: ${pg.DATABASE_URL}
          scope: RUN_TIME
        - key: ELASTICSEARCH_URL
          scope: RUN_TIME
        - key: REDIS_URL
          scope: RUN_TIME
        - key: REDIS_CHECKPOINT
          value: "true"
          scope: RUN_TIME
  databases:
    - name: pg
